(function(){var t,e;t=function(){function t(t,e,i){return this.$rootScope=t,this.imagoUtils=e,{restrict:"E",scope:!0,templateUrl:"/imago/imago-video.html",controller:"imagoVideoController as imagovideo",bindToController:!0,link:function(t,e,o){var s,r,a,n;for(r in o)_.isUndefined(t.imagovideo.opts[r])||("true"===(a=o[r])||"false"===a?t.imagovideo.opts[r]=JSON.parse(o[r]):isNaN(o[r])?t.imagovideo.opts[r]=o[r]:t.imagovideo.opts[r]=Number(o[r]));return s=function(){return t.$applyAsync(function(){return t.$destroy(),e.remove()})},o.data.match(/[0-9a-fA-F]{24}/)?n=o.$observe("data",function(e){return e?(n(),i.getById(e).then(function(e){var i,o;return(null!=e&&null!=(i=e.fields)&&null!=(o=i.formats)?o.length:void 0)?t.imagovideo.init(e):("undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+e._id+" has no formats"),s())})):void 0}):o.data.match(/^\//)?i.getData(o.data).then(function(e){var i,o,r,a,n;for(i=0,r=e.length;r>i;i++){if(o=e[i],!(null!=(a=o.fields)&&null!=(n=a.formats)?n.length:void 0))return"undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+o._id+" has no formats"),s();t.imagovideo.init(o);break}}):n=t.$watch(o.data,function(e){return function(e){var i,o;if(e)return n(),(null!=(i=e.fields)&&null!=(o=i.formats)?o.length:void 0)?t.imagovideo.init(e):("undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+e._id+" has no formats"),s())}}(this))}}}return t}(),e=function(){function t(t,e,i,o,s,r){this.$rootScope=t,this.$attrs=e,this.$scope=i,this.$element=o,this.$sce=s,this.imagoModel=r,this.watchers=[],this.sources=[],this.dpr=Math.ceil(window.devicePixelRatio,1)||1,this.opts={autobuffer:null,autoplay:!1,controls:!0,controlsAutohide:!0,preload:!1,size:"hd",align:"center center",sizemode:"fit",loop:!1,responsive:!0,theme:"//storage.googleapis.com/videoangular-default-theme/videogular.min.css"},this.$scope.$on("$destroy",function(t){return function(){var e,i,o,s,r;for(o=t.watchers,s=[],e=0,i=o.length;i>e;e++)r=o[e],s.push(r());return s}}(this))}return t.prototype.init=function(t){var e,i,o,s;return this.asset=t,this.resolution=this.asset.resolution.split("x"),this.assetRatio=_.first(this.resolution)/_.last(this.resolution),this.spacerStyle={paddingBottom:_.last(this.resolution)/_.first(this.resolution)*100+"%"},(null!=(e=this.asset.fields)&&null!=(i=e.crop)?i.value:void 0)&&!this.$attrs.align&&(this.opts.align=this.asset.fields.crop.value),(null!=(o=this.asset.fields)&&null!=(s=o.sizemode)?s.value:void 0)&&"default"!==this.asset.fields.sizemode.value&&!this.$attrs.sizemode&&(this.opts.sizemode=this.asset.fields.sizemode.value),this.opts.responsive&&this.watchers.push(this.$rootScope.$on("resize",function(t){return function(){var e;return t.getSize(),t.resize(),e=t.mainSide,e!==t.mainSide?t.$scope.$digest():void 0}}(this))),this.$scope.$applyAsync(function(t){return function(){var e,i;return t.getSize(),0===t.height&&0===t.width?console.log("need width or/and height for static or relative positioning"):(t.height>0&&0===t.width?t.mainSide="autoheight":t.width>0&&0===t.height?t.mainSide="autowidth":"crop"===t.opts.sizemode?t.mainSide=t.assetRatio>1?"height":"width":t.mainSide=t.assetRatio<1?"height":"width",t.ready=!0,t.resize(),imagoUtils.isMobile()&&(t.asset.fields.formats=_.filter(t.asset.fields.formats,function(t){var e;return"1080p"!==(e=t.size)?!0:void 0})),i=_.sortBy(_.filter(t.asset.fields.formats,{codec:"webm"}),"height").reverse(),e=_.sortBy(_.filter(t.asset.fields.formats,{codec:"mp4"}),"height").reverse(),t.sources.push({src:t.$sce.trustAsResourceUrl("//"+t.imagoModel.host+"/api/play_redirect?uuid="+t.asset.uuid+"&codec="+_.first(e).codec+"&size="+_.first(e).size),type:"video/"+_.first(e).codec}),t.sources.push({src:t.$sce.trustAsResourceUrl("//"+t.imagoModel.host+"/api/play_redirect?uuid="+t.asset.uuid+"&codec="+_.first(i).codec+"&size="+_.first(i).size),type:"video/"+_.first(i).codec}),t.asset.serving_url?t.poster=t.asset.serving_url+"=s2000-h720":void 0)}}(this))},t.prototype.getSize=function(){return this.width=this.$element.children()[0].clientWidth,this.height=this.$element.children()[0].clientHeight,console.log("getSize: "+this.width+"x"+this.height)},t.prototype.resize=function(){var t;return"autoheight"!==(t=this.mainSide)&&"autowidth"!==t?(this.wrapperRatio=this.width/this.height,"crop"===this.opts.sizemode?this.mainSide=this.assetRatio<this.wrapperRatio?"width":"height":this.mainSide=this.assetRatio>this.wrapperRatio?"width":"height"):void 0},t}(),angular.module("imago").directive("imagoVideo",["$rootScope","imagoUtils","imagoModel",t]).controller("imagoVideoController",["$rootScope","$attrs","$scope","$element","$sce","imagoModel",e])}).call(this),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-video.html",'<div ng-class="[imagovideo.opts.align, imagovideo.opts.sizemode, imagovideo.mainSide]" class="imago-video-content"><div class="imago-video-wrapper"><div ng-style="imagovideo.spacerStyle" class="spacer"></div><videogular vg-auto-play="::imagovideo.opts.autoplay" vg-theme="::imagovideo.opts.theme" ng-if="imagovideo.ready"><vg-media vg-src="::imagovideo.sources" vg-loop="::imagovideo.opts.loop" vg-preload="::imagovideo.opts.preload"></vg-media><vg-controls ng-show="::imagovideo.opts.controls" vg-autohide="::imagovideo.opts.controlsAutohide"><vg-play-pause-button></vg-play-pause-button><vg-time-display>{{ currentTime | date:\'mm:ss\' }}</vg-time-display><vg-scrub-bar><vg-scrub-bar-current-time></vg-scrub-bar-current-time></vg-scrub-bar><vg-time-display>{{ timeLeft | date:\'mm:ss\' }}</vg-time-display><vg-volume><vg-mute-button></vg-mute-button><vg-volume-bar></vg-volume-bar></vg-volume><vg-fullscreen-button></vg-fullscreen-button></vg-controls><vg-overlay-play></vg-overlay-play><vg-poster vg-url="::imagovideo.poster"></vg-poster></videogular></div></div>')}]);