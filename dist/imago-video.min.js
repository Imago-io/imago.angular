var imagoControls,imagoControlsController;imagoControls=function(){function t(){return{replace:!0,require:"^imagoVideo",templateUrl:"/imago/controls-video.html",controller:"imagoControlsController as imagocontrols",link:function(t,e,i){return t.seek=function(e){return t.imagovideo.player.currentTime=e},t.onVolumeChange=function(e){return function(e){return t.imagovideo.player.volume=parseFloat(e/100)}}(this),t.volumeDown=function(e){return function(){return t.imagovideo.player.volume=0,t.volumeInput=0}}(this),t.volumeUp=function(e){return function(){return t.imagovideo.player.volume=1,t.volumeInput=100}}(this),t.fullScreen=function(e){return function(){return t.imagovideo.player.requestFullscreen?t.imagovideo.player.requestFullscreen():t.imagovideo.player.webkitRequestFullscreen?t.imagovideo.player.webkitRequestFullscreen():t.imagovideo.player.mozRequestFullScreen?t.imagovideo.player.mozRequestFullScreen():t.imagovideo.player.msRequestFullscreen?t.imagovideo.player.msRequestFullscreen():void 0}}(this),e.bind("mouseup",function(t){return t.stopPropagation()}),e.bind("mousedown",function(t){return t.stopPropagation()})}}}return t}(),imagoControlsController=function(){function t(t){var e;e=angular.element(t.imagovideo.player),t.currentTime=0,e.bind("loadeddata",function(e){return t.duration=parseInt(e.target.duration),t.$digest()}),e.bind("timeupdate",function(e){return t.currentTime=e.target.currentTime,t.$digest()}),e.bind("seeking",function(e){return t.currentTime=e.target.currentTime,t.$digest()})}return t}(),angular.module("imago").directive("imagoControls",[imagoControls]).controller("imagoControlsController",["$scope",imagoControlsController]);var imagoVideo,imagoVideoController;imagoVideo=function(){function t(t,e,i,o){return this.$timeout=t,this.$rootScope=e,{scope:!0,templateUrl:"/imago/imago-video.html",controller:"imagoVideoController as imagovideo",bindToController:!0,link:function(t,e,i){var r,s;return r=function(){return t.$applyAsync(function(){return t.$destroy(),e.remove()})},s=i.imagoVideo.match(/[0-9a-fA-F]{24}/)?i.$observe("imagoVideo",function(e){var i,n;if(e)return s(),e=o.find({_id:e}),(null!=(i=e.fields)&&null!=(n=i.formats)?n.length:void 0)?t.imagovideo.init(e):("undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+e._id+" has no formats"),r())}):t.$watch(i.imagoVideo,function(e){return function(e){var i,o;if(e)return s(),(null!=(i=e.fields)&&null!=(o=i.formats)?o.length:void 0)?t.imagovideo.init(e):("undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+e._id+" has no formats"),r())}}(this))}}}return t}(),imagoVideoController=function(){function t(t,e,i,o,r){var s,n;this.$rootScope=t,this.$attrs=e,this.$scope=i,this.$element=o,this.$sce=r,this.watchers=[],this.dpr=Math.ceil(window.devicePixelRatio,1)||1,this.opts={autobuffer:null,autoplay:!1,controls:!0,preload:"none",size:"hd",align:"center center",sizemode:"fit",hires:!0,loop:!1,width:"",height:"",responsive:!0};for(s in this.$attrs)this.opts[s]&&("true"===(n=this.$attrs[s])||"false"===n?this.opts[s]=JSON.parse(this.$attrs[s]):isNaN(this.$attrs[s])?this.opts[s]=this.$attrs[s]:this.opts[s]=Number(this.$attrs[s]));this.opts.responsive&&this.watchers.push(this.$rootScope.$on("resize",function(t){return function(){return t.$scope.$applyAsync(function(){return t.resize()})}}(this))),this.$scope.$on("$destroy",function(t){return function(){var e,i,o,r,s;for(o=t.watchers,r=[],e=0,i=o.length;i>e;e++)s=o[e],r.push(s());return r}}(this))}return t.prototype.init=function(t){var e,i,o,r,s,n,a,l,u;for(this.asset=t,this.placeholderUrl=this.asset.b64||this.asset.serving_url+"=s3",this.resolution=this.asset.resolution.split("x"),this.assetRatio=_.first(this.resolution)/_.last(this.resolution),this.spacerStyle={paddingBottom:_.last(this.resolution)/_.first(this.resolution)*100+"%"},"crop"===this.opts.sizemode?this.mainSide=this.assetRatio>1?"height":"width":this.mainSide=this.assetRatio<1?"height":"width",(null!=(r=this.asset.fields)&&null!=(s=r.crop)?s.value:void 0)&&!this.$attrs.align&&(this.opts.align=this.asset.fields.crop.value),(null!=(n=this.asset.fields)&&null!=(a=n.sizemode)?a.value:void 0)&&"default"!==this.asset.fields.sizemode.value&&!this.$attrs.sizemode&&(this.opts.sizemode=this.asset.fields.sizemode.value),this.sources=[],e="online"===data?"api.imago.io":"localhost:8000",l=this.asset.fields.formats,i=0,o=l.length;o>i;i++)u=l[i],this.sources.push({src:this.$sce.trustAsResourceUrl("//"+e+"/api/play_redirect?uuid="+this.asset.uuid+"&codec="+u.codec+"&quality=hd"),type:"video/"+u.codec});return this.asset.serving_url&&(this.poster=this.asset.serving_url+"=s720"),this.$scope.$applyAsync(function(t){return function(){return t.resize()}}(this))},t.prototype.resize=function(){return this.width=this.$element.children()[0].clientWidth,this.height=this.$element.children()[0].clientHeight,this.wrapperRatio=this.width/this.height,this.height?"crop"===this.opts.sizemode?this.mainSide=this.assetRatio<this.wrapperRatio?"width":"height":this.mainSide=this.assetRatio>this.wrapperRatio?"width":"height":void 0},t}(),angular.module("imago").directive("imagoVideo",["$timeout","$rootScope","imagoUtils","imagoModel",imagoVideo]).controller("imagoVideoController",["$rootScope","$attrs","$scope","$element","$sce",imagoVideoController]);var Time;Time=function(){function t(){return function(t){var e,i,o,r,s;if("number"==typeof t)return r=function(t){return 10>t?"0"+t:t},e=[],o=Math.floor(t/60),i=Math.floor(t/3600),s=0===t?0:t%60,s=Math.round(s),i>0&&e.push(r(i)),e.push(r(o)),e.push(r(s)),e.join(":")}}return t}(),angular.module("imago").filter("time",[Time]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-video.html",'<div ng-class="[imagovideo.opts.align, imagovideo.opts.sizemode, imagovideo.mainSide]" class="imago-video"><div class="imago-video-wrapper"><div ng-style="::imagovideo.spacerStyle" class="spacer"></div><videogular vg-auto-play="::imagovideo.opts.autoplay"><vg-media vg-src="imagovideo.sources"></vg-media><vg-controls ng-if="::imagovideo.opts.controls" vg-autohide="true"><vg-play-pause-button></vg-play-pause-button><vg-time-display>{{ currentTime | date:\'mm:ss\' }}</vg-time-display><vg-scrub-bar><vg-scrub-bar-current-time></vg-scrub-bar-current-time></vg-scrub-bar><vg-time-display>{{ timeLeft | date:\'mm:ss\' }}</vg-time-display><vg-volume><vg-mute-button></vg-mute-button><vg-volume-bar></vg-volume-bar></vg-volume><vg-fullscreen-button></vg-fullscreen-button></vg-controls><vg-overlay-play></vg-overlay-play><vg-poster vg-url="imagovideo.poster"></vg-poster></videogular></div></div>')}]);