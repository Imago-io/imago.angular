(function(){var e,i;e=function(){function e(){return{replace:!0,require:"^imagoVideo",templateUrl:"/imago/controls-video.html",controller:"imagoControlsController as imagocontrols",link:function(e,i,o){return e.seek=function(i){return e.imagovideo.player.currentTime=i},e.onVolumeChange=function(i){return function(i){return e.imagovideo.player.volume=parseFloat(i/100)}}(this),e.volumeDown=function(i){return function(){return e.imagovideo.player.volume=0,e.volumeInput=0}}(this),e.volumeUp=function(i){return function(){return e.imagovideo.player.volume=1,e.volumeInput=100}}(this),e.fullScreen=function(i){return function(){return e.imagovideo.player.requestFullscreen?e.imagovideo.player.requestFullscreen():e.imagovideo.player.webkitRequestFullscreen?e.imagovideo.player.webkitRequestFullscreen():e.imagovideo.player.mozRequestFullScreen?e.imagovideo.player.mozRequestFullScreen():e.imagovideo.player.msRequestFullscreen?e.imagovideo.player.msRequestFullscreen():void 0}}(this),i.bind("mouseup",function(e){return e.stopPropagation()}),i.bind("mousedown",function(e){return e.stopPropagation()})}}}return e}(),i=function(){function e(e){var i;i=angular.element(e.imagovideo.player),e.currentTime=0,i.bind("loadeddata",function(i){return e.duration=parseInt(i.target.duration),e.$digest()}),i.bind("timeupdate",function(i){return e.currentTime=i.target.currentTime,e.$digest()}),i.bind("seeking",function(i){return e.currentTime=i.target.currentTime,e.$digest()})}return e}(),angular.module("imago").directive("imagoControls",[e]).controller("imagoControlsController",["$scope",i])}).call(this),function(){var e,i;e=function(){function e(e,i,o,t){return{replace:!0,scope:!0,templateUrl:"/imago/imago-video.html",controller:"imagoVideoController as imagovideo",link:function(n,a,r){var l,s,u,c,d,p,g,m,v,f,h,y,w,b,z;f={},n.source=void 0,n.visible=!1,g={autobuffer:null,autoplay:!1,controls:!0,preload:"none",size:"hd",align:"center center",sizemode:"fit",lazy:!0,hires:!0,loop:!1,width:"",height:""};for(c in r)b=r[c],"true"===b||"false"===b?g[c]=JSON.parse(b):"width"===c||"height"===c?g[c]="auto"===b?b:parseInt(b):g[c]=b;return u=/[0-9a-fA-F]{24}/,r.imagoVideo.match(u)?f.watch=r.$observe("imagoVideo",function(e){return e?(n.source=t.find({_id:e}),r.watch||f.watch(),l()):void 0}):f.watch=n.$watch(r.imagoVideo,function(e){return function(e){return e?(n.source=e,r.watch||f.watch(),l()):void 0}}(this)),l=function(){var e,i,o,t;return(null!=(e=n.source.fields)&&null!=(i=e.formats)?i.length:void 0)?((null!=(o=n.source.fields)?o.hasOwnProperty("crop"):void 0)&&!r.align&&(g.align=n.source.fields.crop.value),(null!=(t=n.source.fields)?t.hasOwnProperty("sizemode"):void 0)&&("default"===n.source.fields.sizemode.value||r.sizemode||(g.sizemode=n.source.fields.sizemode.value)),m()):console.log("no formats found")},m=function(){var e,i,o,t,r,l,s;return angular.isString(n.source.resolution)&&(o=n.source.resolution.split("x"),t={width:o[0],height:o[1]},g.assetRatio=o[0]/o[1]),n.controls=g.controls,g.width&&g.height?(s=g.width,i=g.height):(s=a[0].clientWidth,i=a[0].clientHeight),e=g.hires?Math.ceil(window.devicePixelRatio)||1:1,n.source.serving_url&&(r=n.source.serving_url+"=s"+(Math.ceil(Math.min(Math.max(s,i)*e))||1600)),l={size:g.size,sizemode:g.sizemode,backgroundPosition:g.align,backgroundRepeat:"no-repeat"},r&&(l.backgroundImage="url("+r+")"),n.wrapperStyle=l,h(),n.videoFormats=d(),v(s,i,r)},h=function(){return g.autoplay===!0&&n.imagovideo.player.setAttribute("autoplay",!0),n.imagovideo.player.setAttribute("preload",g.preload),n.imagovideo.player.setAttribute("x-webkit-airplay","allow"),n.imagovideo.player.setAttribute("webkitAllowFullscreen",!0),g.loop===!0?n.imagovideo.player.setAttribute("loop",g.loop):void 0},v=function(i){return function(i,o,t){var a,l;return g.lazy&&!n.visible?f.visibleFunc=n.$watch(r.visible,function(e){return n.visible=e,e?(f.visibleFunc(),v(i,o,t)):void 0}):(l=function(){return e(function(){return _.assign(n.wrapperStyle,w(i,o)),n.videoStyle=y(i,o),n.loading=!1})},a=angular.element("<img>"),a.on("load",l),t?a[0].src=t:l())}}(this),w=function(e,i){var o,t;if(e&&i)return o={},t=e/i,"crop"===g.sizemode?g.assetRatio<t?o.backgroundSize="100% auto":o.backgroundSize="auto 100%":g.assetRatio<t?(o.width=Math.round(i*g.assetRatio)+"px",o.height=i+"px",o.backgroundSize="auto 100%"):(o.width=e+"px",o.height=Math.round(e/g.assetRatio)+"px",o.backgroundSize="100% auto"),o},y=function(e){return function(e,i){var t,n;if(e&&i)return t={},n=e/i,o.isiOS()?(t.width="100%",t.height="100%","center center"===g.align&&"crop"===g.sizemode&&(t.top="0",t.left="0")):"crop"===g.sizemode?g.assetRatio<n?(t.width="100%",t.height="auto","center center"===g.align&&(t.top="50%",t.left="auto",t.marginTop="-"+Math.round(i/2)+"px",t.marginLeft="0px")):(t.width="auto",t.height="100%","center center"===g.align&&(t.top="auto",t.left="50%",t.marginTop="0px",t.marginLeft="-"+Math.round(e/2)+"px")):g.assetRatio<n?(t.width="auto",t.height="100%"):(t.width="100%",t.height="auto"),t}}(this),d=function(){var e,i,o,t,a,r,l,u;for(o=[],e=s(),n.source.fields.formats.sort(function(e,i){return i.height-e.height}),t="online"===data?"api.imago.io":"localhost:8000",u=n.source.fields.formats,a=r=0,l=u.length;l>r;a=++r)i=u[a],e===i.codec&&o.push({src:"//"+t+"/api/play_redirect?uuid="+n.source.uuid+"&codec="+i.codec+"&quality=hd&max_size="+i.size,size:i.size,codec:i.codec,type:"video/"+e});return o},s=function(){var e;if(n.imagovideo.player.canPlayType){e={mp4:'video/mp4; codecs="mp4v.20.8"',mp4:'video/mp4; codecs="avc1.42E01E"',mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',webm:'video/webm; codecs="vp8, vorbis"',ogg:'video/ogg; codecs="theora"'};for(c in e)if(b=e[c],n.imagovideo.player.canPlayType(b))return c}},n.toggleSize=function(){return"hd"===g.size?(g.size="sd",n.wrapperStyle.size="sd"):(g.size="hd",n.wrapperStyle.size="hd"),n.videoFormats.reverse(),e(function(){return n.imagovideo.player.load(),n.imagovideo.player.play()})},p=function(){var e,i;return i=a[0].clientWidth||g.width,e=a[0].clientHeight||g.height,_.assign(n.wrapperStyle,w(i,e)),n.videoStyle=y(i,e),n.$apply()},z={},z.resize=i.$on("resize",p),z.resizestop=i.$on("resizestop",function(){return m(n.source)}),z.action=i.$on("imagovideo:action",function(e,i){var o;if(!i.id!==n.source._id&&i.action&&_.isFunction(null!=(o=n.imagovideo.player)?o[i.action]:void 0))return n.imagovideo.player[i.action]()}),n.$on("$destroy",function(){var e;e=[];for(c in z)e.push(z[c]());return e}),n.$on("$stateChangeSuccess",function(){return e(function(){var e;return document.createEvent?(e=new Event("checkInView"),window.dispatchEvent(e)):(e=document.createEventObject(),e.eventType="checkInView",e.eventName="checkInView",window.fireEvent("on"+e.eventType,e))})})}}}return e}(),i=function(){function e(e,i,o){this.player=i.find("video")[0],e.loading=!0,angular.element(this.player).bind("ended",function(e){return function(i){return e.player.currentTime=0,e.state="end"}}(this)),angular.element(this.player).bind("loadeddata",function(i){return function(){return e.hasPlayed=!0,angular.element(i.player).unbind("loadeddata")}}(this)),angular.element(this.player).bind("play",function(e){return function(){return e.state="playing"}}(this))}return e.prototype.togglePlay=function(){return this.player.paused?(this.state="playing",this.player.play()):(this.state="paused",this.player.pause())},e}(),angular.module("imago").directive("imagoVideo",["$timeout","$rootScope","imagoUtils","imagoModel",e]).controller("imagoVideoController",["$scope","$element","$attrs",i])}.call(this),function(){var e;e=function(){function e(){return function(e){var i,o,t,n,a;if("number"==typeof e)return n=function(e){return 10>e?"0"+e:e},i=[],t=Math.floor(e/60),o=Math.floor(e/3600),a=0===e?0:e%60,a=Math.round(a),o>0&&i.push(n(o)),i.push(n(t)),i.push(n(a)),i.join(":")}}return e}(),angular.module("imago").filter("time",[e])}.call(this),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/controls-video.html",'<div stop-propagation="stop-propagation" class="controls"><a ng-click="imagovideo.togglePlay()" ng-class="{\'fa-pause\': imagovideo.state === \'playing\', \'fa-play\': imagovideo.state === \'paused\'}" analytics-on="click" analytics-event="Video {{ imagovideo.state }}" class="video-play fa fa-play"></a><span class="video-time">{{currentTime | time}}</span><span class="video-seekbar"><input type="range" ng-model="currentTime" min="0" max="{{duration}}" ng-change="seek(currentTime)" class="seek"/></span><a ng-click="toggleSize()" class="size">{{wrapperStyle.size}}</a><span class="volume"><span ng-click="volumeUp()" class="fa fa-volume-up icon-volume-up"></span><input type="range" ng-model="volumeInput" ng-change="onVolumeChange(volumeInput)"/><span ng-click="volumeDown()" class="fa fa-volume-down icon-volume-down"></span></span><a ng-click="fullScreen()" analytics-on="click" analytics-event="Video Full Screen" class="video-fullscreen fa fa-expand"></a><a class="video-screen fa fa-compress"></a></div>'),e.put("/imago/imago-video.html",'<div ng-class="{loading: loading}" in-view="visible = $inview" visible="visible" responsive-events="responsive-events" class="imagovideo {{wrapperStyle.backgroundPosition}} {{wrapperStyle.size}} {{wrapperStyle.sizemode}}"><div ng-style="wrapperStyle" ng-class="imagovideo.state" class="imagowrapper"><a ng-hide="loading" ng-click="imagovideo.togglePlay()" ng-class="{playing: imagovideo.isPlaying}" stop-propagation="stop-propagation" analytics-on="click" analytics-event="Video Play Big" class="playbig fa fa-play"></a><video ng-style="videoStyle"><source ng-repeat="format in videoFormats" src="{{format.src}}" data-size="{{format.size}}" data-codec="{{format.codec}}" type="{{format.type}}"/></video><div imago-controls="imago-controls" ng-style="controlStyle" ng-show="controls &amp;&amp; hasPlayed"></div></div></div>')}]);