(function(){var t,e,i=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(){return{templateUrl:function(t){return t.templateUrl||"/imago/imago-video.html"},controller:"imagoVideoController as imagovideo",bindings:{data:"<?",onReady:"&?"}}}return t}(),e=function(){function t(t,e,s,o,a,r,n){this.$rootScope=t,this.$attrs=e,this.$scope=s,this.$element=o,this.$sce=a,this.imagoUtils=r,this.imagoModel=n,this.onPlayerReady=i(this.onPlayerReady,this),this.watchers=[],this.sources=[],this.dpr=Math.ceil(window.devicePixelRatio,1)||1,this.opts={autobuffer:null,autoplay:!1,controls:!0,preload:!1,size:"hd",align:"center center",sizemode:"fit",loop:!1,autoplayInview:!1,responsive:!0,theme:"//storage.googleapis.com/videoangular-default-theme/videogular.min.css"}}return t.prototype.$postLink=function(){var t,e,i,s,o,a;for(t in this.$attrs)_.isUndefined(this.opts[t])||("true"===(e=this.$attrs[t])||"false"===e?this.opts[t]=JSON.parse(this.$attrs[t]):isNaN(this.$attrs[t])?this.opts[t]=this.$attrs[t]:this.opts[t]=Number(this.$attrs[t]));return this.$attrs.data.match(/[0-9a-fA-F]{24}/)?a=this.$attrs.$observe("data",function(t){return function(e){return e?(a(),t.imagoModel.getById(e).then(function(e){var i,s;return(null!=e&&null!=(i=e.fields)&&null!=(s=i.formats)?s.length:void 0)?t.init(e):("undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+e._id+" has no formats"),t.destroy())})):void 0}}(this)):this.$attrs.data.match(/^\//)?this.imagoModel.getData(this.$attrs.data).then(function(t){return function(e){var i,s,o,a,r;for(i=0,o=e.length;o>i;i++){if(s=e[i],!(null!=(a=s.fields)&&null!=(r=a.formats)?r.length:void 0))return"undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+s._id+" has no formats"),t.destroy();t.init(s);break}}}(this)):this.data?(null!=(i=this.data)&&null!=(s=i.fields)&&null!=(o=s.formats)?o.length:void 0)?this.init(this.data):("undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+this.data._id+" has no formats"),this.destroy()):this.destroy()},t.prototype.$onDestroy=function(){var t,e,i,s,o;for(i=this.watchers,s=[],t=0,e=i.length;e>t;t++)o=i[t],s.push(o());return s},t.prototype.destroy=function(){return this.$scope.$applyAsync(function(){return this.$scope.$destroy(),this.$element.remove()})},t.prototype.init=function(t){var e,i,s,o;return this.asset=t,this.resolution=this.asset.resolution.split("x"),this.assetRatio=_.head(this.resolution)/_.last(this.resolution),this.spacerStyle={paddingBottom:_.last(this.resolution)/_.head(this.resolution)*100+"%"},(null!=(e=this.asset.fields)&&null!=(i=e.crop)?i.value:void 0)&&!this.$attrs.align&&(this.opts.align=this.asset.fields.crop.value),(null!=(s=this.asset.fields)&&null!=(o=s.sizemode)?o.value:void 0)&&"default"!==this.asset.fields.sizemode.value&&!this.$attrs.sizemode&&(this.opts.sizemode=this.asset.fields.sizemode.value),this.opts.responsive&&this.watchers.push(this.$rootScope.$on("resize",function(t){return function(){var e;return t.getSize(),t.resize(),e=t.mainSide,e!==t.mainSide?t.$scope.$digest():void 0}}(this))),this.$scope.$applyAsync(function(t){return function(){var e,i;return t.getSize(),0===t.height&&0===t.width?console.log("need width or/and height for static or relative positioning"):(t.height>0&&0===t.width?t.mainSide="autoheight":t.width>0&&0===t.height?t.mainSide="autowidth":"crop"===t.opts.sizemode?t.mainSide=t.assetRatio>1?"height":"width":t.mainSide=t.assetRatio<1?"height":"width",t.ready=!0,t.resize(),t.imagoUtils.isMobile()&&(t.asset.fields.formats=_.filter(t.asset.fields.formats,function(t){var e;return"1080p"!==(e=t.size)?!0:void 0})),i=_.sortBy(_.filter(t.asset.fields.formats,{codec:"webm"}),"height").reverse(),e=_.sortBy(_.filter(t.asset.fields.formats,{codec:"mp4"}),"height").reverse(),t.sources.push({src:t.$sce.trustAsResourceUrl(t.imagoModel.host+"/api/play_redirect?uuid="+t.asset.uuid+"&codec="+_.head(e).codec+"&size="+_.head(e).size),type:"video/"+_.head(e).codec}),t.sources.push({src:t.$sce.trustAsResourceUrl(t.imagoModel.host+"/api/play_redirect?uuid="+t.asset.uuid+"&codec="+_.head(i).codec+"&size="+_.head(i).size),type:"video/"+_.head(i).codec}),t.asset.serving_url?t.poster=t.asset.serving_url+"=s2000-h720":void 0)}}(this))},t.prototype.getSize=function(){return this.width=this.$element.children()[0].clientWidth,this.height=this.$element.children()[0].clientHeight},t.prototype.onPlayerReady=function(t){return this.onReady&&this.onReady({api:t}),this.opts.autoplayInview?this.$scope.$watch("imagovideo.visible",function(e){return function(e){return e?t.play():t.pause()}}(this)):void 0},t.prototype.resize=function(){var t;return"autoheight"!==(t=this.mainSide)&&"autowidth"!==t?(this.wrapperRatio=this.width/this.height,"crop"===this.opts.sizemode?this.mainSide=this.assetRatio<this.wrapperRatio?"width":"height":this.mainSide=this.assetRatio>this.wrapperRatio?"width":"height"):void 0},t}(),angular.module("imago").component("imagoVideo",new t).controller("imagoVideoController",["$rootScope","$attrs","$scope","$element","$sce","imagoUtils","imagoModel",e])}).call(this),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-video.html",'<div ng-class="[imagovideo.opts.align, imagovideo.opts.sizemode, imagovideo.mainSide, imagovideo.state]" in-view="imagovideo.visible = $inview" in-view-options="{debounce: 50}" class="imago-video-content"><div class="imago-video-wrapper"><div ng-style="imagovideo.spacerStyle" class="spacer"></div><videogular vg-auto-play="::imagovideo.opts.autoplay" vg-theme="::imagovideo.opts.theme" ng-if="imagovideo.ready" vg-update-state="imagovideo.state = $state" vg-player-ready="imagovideo.onPlayerReady($API)"><vg-media vg-src="::imagovideo.sources" vg-loop="::imagovideo.opts.loop" vg-preload="::imagovideo.opts.preload"></vg-media><vg-controls ng-if="::imagovideo.opts.controls"><vg-play-pause-button></vg-play-pause-button><vg-time-display>{{ currentTime | date:\'mm:ss\' }}</vg-time-display><vg-scrub-bar><vg-scrub-bar-current-time></vg-scrub-bar-current-time></vg-scrub-bar><vg-time-display>{{ timeLeft | date:\'mm:ss\' }}</vg-time-display><vg-volume><vg-mute-button></vg-mute-button><vg-volume-bar></vg-volume-bar></vg-volume><vg-fullscreen-button></vg-fullscreen-button></vg-controls><vg-overlay-play></vg-overlay-play><vg-poster vg-url="::imagovideo.poster"></vg-poster></videogular></div></div>')}]);