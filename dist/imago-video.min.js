(function(){var e,t,i=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,t,i){return this.$rootScope=e,this.imagoUtils=t,{restrict:"E",scope:!0,templateUrl:"/imago/imago-video.html",controller:"imagoVideoController as imagovideo",bindToController:!0,link:function(e,t,o){var s,a,r,n;for(a in o)_.isUndefined(e.imagovideo.opts[a])||("true"===(r=o[a])||"false"===r?e.imagovideo.opts[a]=JSON.parse(o[a]):isNaN(o[a])?e.imagovideo.opts[a]=o[a]:e.imagovideo.opts[a]=Number(o[a]));return s=function(){return e.$applyAsync(function(){return e.$destroy(),t.remove()})},o.data.match(/[0-9a-fA-F]{24}/)?n=o.$observe("data",function(t){return t?(n(),i.getById(t).then(function(t){var i,o;return(null!=t&&null!=(i=t.fields)&&null!=(o=i.formats)?o.length:void 0)?e.imagovideo.init(t):("undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+t._id+" has no formats"),s())})):void 0}):o.data.match(/^\//)?i.getData(o.data).then(function(t){var i,o,a,r,n;for(i=0,a=t.length;a>i;i++){if(o=t[i],!(null!=(r=o.fields)&&null!=(n=r.formats)?n.length:void 0))return"undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+o._id+" has no formats"),s();e.imagovideo.init(o);break}}):n=e.$watch(o.data,function(t){return function(t){var i,o;if(t)return n(),(null!=(i=t.fields)&&null!=(o=i.formats)?o.length:void 0)?e.imagovideo.init(t):("undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+t._id+" has no formats"),s())}}(this))}}}return e}(),t=function(){function e(e,t,o,s,a,r){this.$rootScope=e,this.$attrs=t,this.$scope=o,this.$element=s,this.$sce=a,this.imagoModel=r,this.onPlayerReady=i(this.onPlayerReady,this),this.watchers=[],this.sources=[],this.dpr=Math.ceil(window.devicePixelRatio,1)||1,this.opts={autobuffer:null,autoplay:!1,controls:!0,preload:!1,size:"hd",align:"center center",sizemode:"fit",loop:!1,autoplayInview:!1,responsive:!0,theme:"//storage.googleapis.com/videoangular-default-theme/videogular.min.css"},this.$scope.$on("$destroy",function(e){return function(){var t,i,o,s,a;for(o=e.watchers,s=[],t=0,i=o.length;i>t;t++)a=o[t],s.push(a());return s}}(this))}return e.prototype.init=function(e){var t,i,o,s;return this.asset=e,this.resolution=this.asset.resolution.split("x"),this.assetRatio=_.head(this.resolution)/_.last(this.resolution),this.spacerStyle={paddingBottom:_.last(this.resolution)/_.head(this.resolution)*100+"%"},(null!=(t=this.asset.fields)&&null!=(i=t.crop)?i.value:void 0)&&!this.$attrs.align&&(this.opts.align=this.asset.fields.crop.value),(null!=(o=this.asset.fields)&&null!=(s=o.sizemode)?s.value:void 0)&&"default"!==this.asset.fields.sizemode.value&&!this.$attrs.sizemode&&(this.opts.sizemode=this.asset.fields.sizemode.value),this.opts.responsive&&this.watchers.push(this.$rootScope.$on("resize",function(e){return function(){var t;return e.getSize(),e.resize(),t=e.mainSide,t!==e.mainSide?e.$scope.$digest():void 0}}(this))),this.$scope.$applyAsync(function(e){return function(){var t,i;return e.getSize(),0===e.height&&0===e.width?console.log("need width or/and height for static or relative positioning"):(e.height>0&&0===e.width?e.mainSide="autoheight":e.width>0&&0===e.height?e.mainSide="autowidth":"crop"===e.opts.sizemode?e.mainSide=e.assetRatio>1?"height":"width":e.mainSide=e.assetRatio<1?"height":"width",e.ready=!0,e.resize(),imagoUtils.isMobile()&&(e.asset.fields.formats=_.filter(e.asset.fields.formats,function(e){var t;return"1080p"!==(t=e.size)?!0:void 0})),i=_.sortBy(_.filter(e.asset.fields.formats,{codec:"webm"}),"height").reverse(),t=_.sortBy(_.filter(e.asset.fields.formats,{codec:"mp4"}),"height").reverse(),e.sources.push({src:e.$sce.trustAsResourceUrl(e.imagoModel.host+"/api/play_redirect?uuid="+e.asset.uuid+"&codec="+_.head(t).codec+"&size="+_.head(t).size),type:"video/"+_.head(t).codec}),e.sources.push({src:e.$sce.trustAsResourceUrl(e.imagoModel.host+"/api/play_redirect?uuid="+e.asset.uuid+"&codec="+_.head(i).codec+"&size="+_.head(i).size),type:"video/"+_.head(i).codec}),e.asset.serving_url?e.poster=e.asset.serving_url+"=s2000-h720":void 0)}}(this))},e.prototype.getSize=function(){return this.width=this.$element.children()[0].clientWidth,this.height=this.$element.children()[0].clientHeight},e.prototype.onPlayerReady=function(e){return console.log("@opts.autoplayInview",this.opts.autoplayInview),this.opts.autoplayInview?this.$scope.$watch("imagovideo.visible",function(t){return function(t){return t?e.play():e.pause()}}(this)):void 0},e.prototype.resize=function(){var e;return"autoheight"!==(e=this.mainSide)&&"autowidth"!==e?(this.wrapperRatio=this.width/this.height,"crop"===this.opts.sizemode?this.mainSide=this.assetRatio<this.wrapperRatio?"width":"height":this.mainSide=this.assetRatio>this.wrapperRatio?"width":"height"):void 0},e}(),angular.module("imago").directive("imagoVideo",["$rootScope","imagoUtils","imagoModel",e]).controller("imagoVideoController",["$rootScope","$attrs","$scope","$element","$sce","imagoModel",t])}).call(this),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/imago-video.html",'<div ng-class="[imagovideo.opts.align, imagovideo.opts.sizemode, imagovideo.mainSide, imagovideo.state]" in-view="imagovideo.visible = $inview" in-view-options="{debounce: 50}" class="imago-video-content"><div class="imago-video-wrapper"><div ng-style="imagovideo.spacerStyle" class="spacer"></div><videogular vg-auto-play="::imagovideo.opts.autoplay" vg-theme="::imagovideo.opts.theme" ng-if="imagovideo.ready" vg-update-state="imagovideo.state = $state" vg-player-ready="imagovideo.onPlayerReady($API)"><vg-media vg-src="::imagovideo.sources" vg-loop="::imagovideo.opts.loop" vg-preload="::imagovideo.opts.preload"></vg-media><vg-controls ng-if="::imagovideo.opts.controls"><vg-play-pause-button></vg-play-pause-button><vg-time-display>{{ currentTime | date:\'mm:ss\' }}</vg-time-display><vg-scrub-bar><vg-scrub-bar-current-time></vg-scrub-bar-current-time></vg-scrub-bar><vg-time-display>{{ timeLeft | date:\'mm:ss\' }}</vg-time-display><vg-volume><vg-mute-button></vg-mute-button><vg-volume-bar></vg-volume-bar></vg-volume><vg-fullscreen-button></vg-fullscreen-button></vg-controls><vg-overlay-play></vg-overlay-play><vg-poster vg-url="::imagovideo.poster"></vg-poster></videogular></div></div>')}]);