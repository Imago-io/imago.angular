!function(){function d(t,e){return function(){return t.apply(e,arguments)}}var t,e;function i(t,e,i,s,o,a,r,n){this.$rootScope=t,this.$attrs=e,this.$scope=i,this.$element=s,this.$sce=o,this.$timeout=a,this.imagoUtils=r,this.imagoModel=n,this.resize=d(this.resize,this),this.onPlayerReady=d(this.onPlayerReady,this),window.debug=!1,this.watchers=[],this.sources=[],this.dpr=Math.ceil(window.devicePixelRatio,1)||1,this.opts={autobuffer:null,autoplay:!1,controls:!0,controlsAutohide:!0,controlsAutohideTime:1e3,preload:!1,size:"hd",align:"center center",sizemode:"fit",loop:!1,autoplayInview:!1,responsive:!0,previewOnly:!1,theme:this.$rootScope.videoTheme||"//themes.imago.io/videoangular-imago-theme/videoangular-imago-theme.min.css"}}t=function(){return{templateUrl:function(t){return t.templateUrl||"/imago/imago-video.html"},controller:"imagoVideoController as imagovideo",bindings:{data:"<?",onReady:"&?"}}},i.prototype.$postLink=function(){var t,e,i,s,a,o;for(t in this.$attrs)_.isUndefined(this.opts[t])||("true"===(e=this.$attrs[t])||"false"===e?this.opts[t]=JSON.parse(this.$attrs[t]):isNaN(this.$attrs[t])?this.opts[t]=this.$attrs[t]:this.opts[t]=Number(this.$attrs[t]));return this.$attrs.data.match(/[0-9a-fA-F]{24}/)?s=this.$attrs.$observe("data",(o=this,function(t){if(t)return s(),o.imagoModel.getById(t).then(function(t){var e;return null!=t&&null!=(e=t.fields)&&null!=(e=e.formats)&&e.length?o.init(t):("undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+t._id+" has no formats"),o.destroy())})})):this.$attrs.data.match(/^\//)?this.imagoModel.getData(this.$attrs.data).then((a=this,function(t){for(var e,i,s=0,o=t.length;s<o;s++){if(null==(i=(e=t[s]).fields)||null==(i=i.formats)||!i.length)return"undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+e._id+" has no formats"),a.destroy();a.init(e);break}})):this.data?null!=(i=this.data)&&null!=(i=i.fields)&&null!=(i=i.formats)&&i.length?this.init(this.data):("undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+this.data._id+" has no formats"),this.destroy()):this.destroy()},i.prototype.$onDestroy=function(){for(var t,e=this.watchers,i=[],s=0,o=e.length;s<o;s++)t=e[s],i.push(t());return i},i.prototype.destroy=function(){return this.$scope.$applyAsync(function(){return this.$scope.$destroy(),this.$element.remove()})},i.prototype.init=function(t){var e,i;return this.asset=t,this.resolution=this.asset.resolution.split("x"),this.assetRatio=_.head(this.resolution)/_.last(this.resolution),this.spacerStyle={paddingBottom:_.last(this.resolution)/_.head(this.resolution)*100+"%"},null!=(t=this.asset.fields)&&null!=(t=t.crop)&&t.value&&!this.$attrs.align&&(this.opts.align=this.asset.fields.crop.value),null!=(t=this.asset.fields)&&null!=(t=t.sizemode)&&t.value&&"default"!==this.asset.fields.sizemode.value&&!this.$attrs.sizemode&&(this.opts.sizemode=this.asset.fields.sizemode.value),this.opts.responsive&&this.watchers.push(this.$rootScope.$on("resize",(e=this,function(){return e.$timeout(function(){return e.getSize(),e.resize(),e.mainSide},0)}))),this.$timeout((i=this,function(){var t,e;return i.getSize(),0===i.height&&0===i.width?console.log("need width or/and height for static or relative positioning"):(0<i.height&&0===i.width?i.mainSide="autoheight":0<i.width&&0===i.height?i.mainSide="autowidth":"crop"===i.opts.sizemode?i.mainSide=1<i.assetRatio?"height":"width":i.mainSide=i.assetRatio<1?"height":"width",i.ready=!0,i.resize(),i.asset.fields.formats=_.filter(i.asset.fields.formats,function(t){if("preview"!==t.size)return!0}),i.imagoUtils.isMobile()&&(i.asset.fields.formats=_.filter(i.asset.fields.formats,function(t){if("1080p"!==t.size)return!0})),t=(i.opts.previewOnly?(e=_.sortBy(_.filter(i.asset.fields.formats,{size:"preview",codec:"webm"}),"height").reverse(),_.sortBy(_.filter(i.asset.fields.formats,{size:"preview",codec:"mp4"}),"height")):(e=_.sortBy(_.filter(i.asset.fields.formats,{codec:"webm"}),"height").reverse(),_.sortBy(_.filter(i.asset.fields.formats,{codec:"mp4"}),"height"))).reverse(),_.head(t)?i.sources.push({src:i.$sce.trustAsResourceUrl(i.imagoModel.host+"/api/play_redirect?uuid="+i.asset.uuid+"&codec="+_.head(t).codec+"&size="+_.head(t).size),type:"video/"+_.head(t).codec}):console.error("Cound not find a mp4 for asset "+i.asset._id),_.head(e)?i.sources.push({src:i.$sce.trustAsResourceUrl(i.imagoModel.host+"/api/play_redirect?uuid="+i.asset.uuid+"&codec="+_.head(e).codec+"&size="+_.head(e).size),type:"video/"+_.head(e).codec}):console.error("Cound not find a webm for asset "+i.asset._id),i.asset.serving_url?i.poster=i.asset.serving_url+"=s2000-h720":void 0)}),50)},i.prototype.getSize=function(){if(this.width=this.$element.children()[0].clientWidth,this.height=this.$element.children()[0].clientHeight,window.debug)return console.debug("imago-video: getSize "+this.width+"x"+this.height)},i.prototype.onPlayerReady=function(e){if(this.onReady&&this.onReady({api:e}),this.opts.autoplayInview)return this.$scope.$watch("imagovideo.visible",function(t){return t?e.play():e.pause()})},i.prototype.resize=function(){var t;if("autoheight"!==(t=this.mainSide)&&"autowidth"!==t&&(this.wrapperRatio=this.width/this.height,"crop"===this.opts.sizemode?this.mainSide=this.assetRatio<this.wrapperRatio?"width":"height":this.mainSide=this.assetRatio>this.wrapperRatio?"width":"height"),window.debug)return console.debug("imago-video: resize "+this.width+"x"+this.height+" @mainSide "+this.mainSide)},e=i,angular.module("imago").component("imagoVideo",new t).controller("imagoVideoController",["$rootScope","$attrs","$scope","$element","$sce","$timeout","imagoUtils","imagoModel",e])}.call(this),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-video.html",'<div ng-class="[imagovideo.opts.align, imagovideo.opts.sizemode, imagovideo.mainSide, imagovideo.state]" in-view="imagovideo.visible = $inview" in-view-options="{debounce: 1000}" class="imago-video-content"><div class="imago-video-wrapper"><div ng-style="imagovideo.spacerStyle" class="spacer"></div><videogular vg-auto-play="::imagovideo.opts.autoplay" vg-theme="::imagovideo.opts.theme" ng-if="imagovideo.ready" vg-update-state="imagovideo.state = $state" vg-player-ready="imagovideo.onPlayerReady($API)"><vg-media vg-src="imagovideo.sources" vg-loop="::imagovideo.opts.loop" vg-preload="::imagovideo.opts.preload"></vg-media><vg-controls ng-if="imagovideo.opts.controls" vg-autohide="::imagovideo.opts.controlsAutohide" vg-autohide-time="::imagovideo.opts.controlsAutohide"><vg-play-pause-button></vg-play-pause-button><vg-time-display>{{ currentTime | date:\'mm:ss\' }}</vg-time-display><vg-scrub-bar><vg-scrub-bar-current-time></vg-scrub-bar-current-time></vg-scrub-bar><vg-time-display>{{ timeLeft | date:\'mm:ss\' }}</vg-time-display><vg-volume><vg-mute-button></vg-mute-button><vg-volume-bar></vg-volume-bar></vg-volume><vg-fullscreen-button></vg-fullscreen-button></vg-controls><vg-overlay-play></vg-overlay-play><vg-poster vg-url="::imagovideo.poster"></vg-poster></videogular></div></div>')}]);