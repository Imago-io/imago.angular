var imagoControls,imagoControlsController;imagoControls=function(){function t(){return{replace:!0,require:"^imagoVideo",templateUrl:"/imago/controls-video.html",controller:"imagoControlsController as imagocontrols",link:function(t,e,i){return t.seek=function(e){return t.imagovideo.player.currentTime=e},t.onVolumeChange=function(e){return function(e){return t.imagovideo.player.volume=parseFloat(e/100)}}(this),t.volumeDown=function(e){return function(){return t.imagovideo.player.volume=0,t.volumeInput=0}}(this),t.volumeUp=function(e){return function(){return t.imagovideo.player.volume=1,t.volumeInput=100}}(this),t.fullScreen=function(e){return function(){return t.imagovideo.player.requestFullscreen?t.imagovideo.player.requestFullscreen():t.imagovideo.player.webkitRequestFullscreen?t.imagovideo.player.webkitRequestFullscreen():t.imagovideo.player.mozRequestFullScreen?t.imagovideo.player.mozRequestFullScreen():t.imagovideo.player.msRequestFullscreen?t.imagovideo.player.msRequestFullscreen():void 0}}(this),e.bind("mouseup",function(t){return t.stopPropagation()}),e.bind("mousedown",function(t){return t.stopPropagation()})}}}return t}(),imagoControlsController=function(){function t(t){var e;e=angular.element(t.imagovideo.player),t.currentTime=0,e.bind("loadeddata",function(e){return t.duration=parseInt(e.target.duration),t.$digest()}),e.bind("timeupdate",function(e){return t.currentTime=e.target.currentTime,t.$digest()}),e.bind("seeking",function(e){return t.currentTime=e.target.currentTime,t.$digest()})}return t}(),angular.module("imago").directive("imagoControls",[imagoControls]).controller("imagoControlsController",["$scope",imagoControlsController]);var imagoVideo,imagoVideoController,bind=function(t,e){return function(){return t.apply(e,arguments)}},indexOf=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};imagoVideo=function(){function t(t,e,i,o){return this.$timeout=t,this.$rootScope=e,{scope:!0,templateUrl:"/imago/imago-video.html",controller:"imagoVideoController as imagovideo",bindToController:!0,link:function(t,e,i){var r,n;return r=function(){return t.$destroy(),e.remove()},n=i.imagoVideo.match(/[0-9a-fA-F]{24}/)?i.$observe("imagoVideo",function(e){return e?(n(),e=o.find({_id:e}),e.serving_url?t.imagovideo.init(e):r()):void 0}):t.$watch(i.imagoVideo,function(e){return function(e){return e?(n(),e.serving_url?t.imagovideo.init(e):r()):void 0}}(this))}}}return t}(),imagoVideoController=function(){function t(t,e,i,o,r){var n,s;this.$rootScope=t,this.$attrs=e,this.$scope=i,this.$element=o,this.$sce=r,this.render=bind(this.render,this),this.watchers=[],this.dpr=Math.ceil(window.devicePixelRatio,1)||1,this.opts={autobuffer:null,autoplay:!1,controls:!0,preload:"none",size:"hd",align:"center center",sizemode:"fit",hires:!0,loop:!1,width:"",height:"",responsive:!0};for(n in this.$attrs)this.opts[n]&&("true"===(s=this.$attrs[n])||"false"===s?this.opts[n]=JSON.parse(this.$attrs[n]):isNaN(this.$attrs[n])?this.opts[n]=this.$attrs[n]:this.opts[n]=Number(this.$attrs[n]));this.opts.responsive&&(this.watchers.push(this.$rootScope.$on("resize",function(t){return function(){return t.$scope.$applyAsync(function(){return t.resize()})}}(this))),this.watchers.push(this.$rootScope.$on("resizestop",function(t){return function(){return console.log("resizestop")}}(this)))),this.$scope.$on("$destroy",function(t){return function(){var e,i,o,r,n;for(o=t.watchers,r=[],e=0,i=o.length;i>e;e++)n=o[e],r.push(n());return r}}(this))}return t.prototype.init=function(t){var e,i,o,r,n,s,a,l,u,d;if(this.data=t,this.placeholderUrl=this.data.b64||this.data.serving_url+"=s3",this.resolution=this.data.resolution.split("x"),this.assetRatio=_.first(this.resolution)/_.last(this.resolution),this.spacerStyle={paddingBottom:_.last(this.resolution)/_.first(this.resolution)*100+"%"},"crop"===this.opts.sizemode?this.mainSide=this.assetRatio>1?"height":"width":this.mainSide=this.assetRatio<1?"height":"width",(null!=(r=this.data.fields)&&null!=(n=r.crop)?n.value:void 0)&&!this.$attrs.align&&(this.opts.align=this.data.fields.crop.value),(null!=(s=this.data.fields)&&null!=(a=s.sizemode)?a.value:void 0)&&"default"!==this.data.fields.sizemode.value&&!this.$attrs.sizemode&&(this.opts.sizemode=this.data.fields.sizemode.value),this.sources=[],e=indexOf.call("online",t)>=0?"api.imago.io":"localhost:8000",!(null!=(l=t.fields.formats)?l.length:void 0))return"undefined"!=typeof trackJs&&null!==trackJs&&trackJs.track("Video "+t._id+" has no formats"),void console.log("Video "+t._id+" has no formats");for(u=t.fields.formats,i=0,o=u.length;o>i;i++)d=u[i],this.sources.push({src:this.$sce.trustAsResourceUrl("//api.imago.io/api/play_redirect?uuid="+t.uuid+"&codec="+d.codec+"&quality=sd"),type:"video/"+d.codec});return this.poster=t.serving_url+"=s720",this.$scope.$applyAsync(function(t){return function(){return t.resize()}}(this))},t.prototype.resize=function(){return console.log("resize"),this.width=this.$element.children()[0].clientWidth,this.height=this.$element.children()[0].clientHeight,this.wrapperRatio=this.width/this.height,this.height?("crop"===this.opts.sizemode?this.mainSide=this.assetRatio<this.wrapperRatio?"width":"height":this.mainSide=this.assetRatio>this.wrapperRatio?"width":"height",console.log("@mainSide",this.mainSide)):void 0},t.prototype.render=function(){return console.log("render")},t}(),angular.module("imago").directive("imagoVideo",["$timeout","$rootScope","imagoUtils","imagoModel",imagoVideo]).controller("imagoVideoController",["$rootScope","$attrs","$scope","$element","$sce",imagoVideoController]);var Time;Time=function(){function t(){return function(t){var e,i,o,r,n;if("number"==typeof t)return r=function(t){return 10>t?"0"+t:t},e=[],o=Math.floor(t/60),i=Math.floor(t/3600),n=0===t?0:t%60,n=Math.round(n),i>0&&e.push(r(i)),e.push(r(o)),e.push(r(n)),e.join(":")}}return t}(),angular.module("imago").filter("time",[Time]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-video.html",'<div ng-class="[imagovideo.opts.align, imagovideo.opts.sizemode, imagovideo.mainSide]" class="imago-video"><div class="imago-video-wrapper"><div ng-style="::imagovideo.spacerStyle" class="spacer"></div><videogular><vg-media vg-src="imagovideo.sources"></vg-media><vg-controls><vg-play-pause-button></vg-play-pause-button><vg-time-display>{{ currentTime | date:\'mm:ss\' }}</vg-time-display><vg-scrub-bar><vg-scrub-bar-current-time></vg-scrub-bar-current-time></vg-scrub-bar><vg-time-display>{{ timeLeft | date:\'mm:ss\' }}</vg-time-display><vg-volume><vg-mute-button></vg-mute-button><vg-volume-bar></vg-volume-bar></vg-volume><vg-fullscreen-button></vg-fullscreen-button></vg-controls><vg-overlay-play></vg-overlay-play><vg-poster vg-url="imagovideo.poster"></vg-poster></videogular></div></div>')}]);