!function(){var i=function(n,a,s,d){return{restrict:"E",scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",onBottom:"&",scroll:"=",offsetBottom:"@",uuid:"@"},link:function(u,t,i,e,l){var r,c,o;return l(u,function(i){return t.children().append(i)}),(c={scrollTop:0}).browserKey=("undefined"!=typeof bowser&&null!==bowser?bowser.safari:void 0)<=8?"-webkit-transform":"transform",c.uuid=u.imagovirtuallist.uuid||"id",u.imagovirtuallist.offsetBottom||(u.imagovirtuallist.offsetBottom=n.innerHeight),(r=document.createElement("div")).id="master-item",r.className=i.classItem,r.style.opacity=0,r.style.zIndex=-1,t.append(r),u.init=function(){if(!c.initRunning)return c.initRunning=!0,u.visibleProvider=[],d(function(){var i;return c.divWidth=r.clientWidth,c.divHeight=r.clientHeight,c.itemsPerRow=Math.floor(t[0].clientWidth/c.divWidth),i=Math.round(n.innerHeight/c.divHeight),c.cellsPerPage=i*c.itemsPerRow,c.numberOfCells=3*c.cellsPerPage,c.canvasWidth=1<c.itemsPerRow?c.itemsPerRow*c.divWidth:null,c.updateData(),c.initRunning=!1},200)},c.updateData=function(){if(u.imagovirtuallist.data)return c.canvasHeight=Math.ceil(u.imagovirtuallist.data.length/c.itemsPerRow)*c.divHeight,u.canvasStyle={height:c.canvasHeight+"px",width:c.canvasWidth+"px"},c.updateDisplayList()},c.updateDisplayList=function(){var a,s,i,t,e=Math.max(Math.round(c.scrollTop/c.divHeight)-Math.round(n.innerHeight/c.divHeight),0),l=Math.min(e+c.numberOfCells,c.numberOfCells),r=e*c.itemsPerRow;for(u.visibleProvider=u.imagovirtuallist.data.slice(r,r+l),a=_.chunk(u.visibleProvider,c.itemsPerRow),s=0,t=u.visibleProvider.length;s<t;)i=function(){for(var i,t,e,l,r,o=e=0,n=a.length;e<n;o=++e)for(t=l=0,r=(i=a[o]).length;l<r;t=++l)if(i[t][c.uuid]===u.visibleProvider[s][c.uuid])return{chunk:o,inside:t}}(),u.visibleProvider[s].styles={},u.visibleProvider[s].styles[c.browserKey]="translate("+c.divWidth*i.inside+"px, "+(e+i.chunk)*c.divHeight+"px)",s++;if(u.imagovirtuallist.scroll)return u.scroll()},u.scroll=function(){if(u.imagovirtuallist.scroll)return d(function(){return c.scrollTop=angular.copy(u.imagovirtuallist.scroll),u.imagovirtuallist.scroll=0,a.scrollTop(c.scrollTop,0)})},u.onScroll=function(){return c.scrollTop=n.scrollY||n.pageYOffset,c.canvasHeight-c.scrollTop<=Number(u.imagovirtuallist.offsetBottom)&&u.imagovirtuallist.onBottom(),c.updateDisplayList(),u.$digest()},u.init(),u.$watch("imagovirtuallist.data",function(i){return c.updateData()}),angular.element(n).on("resize",function(){if(Math.floor(t[0].clientWidth/r.clientWidth)!==c.itemsPerRow)return u.init()}),angular.element(n).on("scroll",u.onScroll),(o=[]).push(s.$on("imagovirtuallist:init",function(){return u.init()})),u.$on("$destroy",function(){var i,t,e,l;for(angular.element(n).off("scroll",u.onScroll),e=[],i=0,t=o.length;i<t;i++)l=o[i],e.push(l());return e})}}};angular.module("imago").directive("imagoVirtualList",["$window","$document","$rootScope","$timeout",i])}.call(this),angular.module("imago").run(["$templateCache",function(i){i.put("/imago/imago-virtual-list.html",'<div ng-style="canvasStyle" class="imago-virtual-list-content"></div>')}]);