var ImagoVirtualList;ImagoVirtualList=function(){function t(t,i,e,l){return{scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",onBottom:"&",scroll:"=",offsetBottom:"@",uuid:"@"},link:function(n,o,r,a,s){var u,c,d;return s(n,function(t){return o.children().append(t)}),c={},c.scrollTop=0,c.browserKey=("undefined"!=typeof bowser&&null!==bowser?bowser.safari:void 0)<=8?"-webkit-transform":"transform",c.uuid=n.imagovirtuallist.uuid||"id",n.imagovirtuallist.offsetBottom||(n.imagovirtuallist.offsetBottom=t.innerHeight),u=document.createElement("div"),u.id="master-item",u.className=r.classItem,u.style.opacity=0,u.style.zIndex=-1,o.append(u),n.init=function(){return this.initRunning?void 0:(this.initRunning=!0,n.visibleProvider=[],l(function(i){return function(){var e;return c.itemsPerRow=Math.floor(o[0].clientWidth/u.clientWidth),e=Math.round(t.innerHeight/u.clientHeight),c.cellsPerPage=e*c.itemsPerRow,c.numberOfCells=3*c.cellsPerPage,c.itemsPerRow>1?c.canvasWidth=c.itemsPerRow*u.clientWidth:c.canvasWidth=null,c.updateData(),i.initRunning=!1}}(this),200))},c.updateData=function(){return n.imagovirtuallist.data?(c.canvasHeight=Math.ceil(n.imagovirtuallist.data.length/c.itemsPerRow)*u.clientHeight,n.canvasStyle={height:c.canvasHeight+"px",width:c.canvasWidth+"px"},c.updateDisplayList()):void 0},c.updateDisplayList=function(){var i,e,l,o,r,a,s,d;for(r=Math.max(Math.round(c.scrollTop/u.clientHeight)-Math.round(t.innerHeight/u.clientHeight),0),i=Math.min(r+c.numberOfCells,c.numberOfCells),l=r*c.itemsPerRow,n.visibleProvider=n.imagovirtuallist.data.slice(l,l+i),e=_.chunk(n.visibleProvider,c.itemsPerRow),a=0,d=n.visibleProvider.length;d>a;)o=function(){var t,i,l,o,r,s,u,d,m;for(l=s=0,d=e.length;d>s;l=++s)for(t=e[l],o=u=0,m=t.length;m>u;o=++u)if(r=t[o],r[c.uuid]===n.visibleProvider[a][c.uuid])return i={chunk:l,inside:o}},s=o(),n.visibleProvider[a].styles={},n.visibleProvider[a].styles[c.browserKey]="translate("+(u.clientWidth*s.inside+"px")+", "+((r+s.chunk)*u.clientHeight+"px")+")",a++;return n.imagovirtuallist.scroll?n.scroll():void 0},n.scroll=function(){return n.imagovirtuallist.scroll?l(function(){return c.scrollTop=angular.copy(n.imagovirtuallist.scroll),n.imagovirtuallist.scroll=0,i.scrollTop(c.scrollTop,0)}):void 0},n.onScroll=function(){return c.scrollTop=t.scrollY||t.pageYOffset,c.canvasHeight-c.scrollTop<=Number(n.imagovirtuallist.offsetBottom)&&n.imagovirtuallist.onBottom(),c.updateDisplayList(),n.$digest()},n.init(),n.$watch("imagovirtuallist.data",function(t){return c.updateData()}),angular.element(t).on("resize",function(t){return function(){return Math.floor(o[0].clientWidth/u.clientWidth)!==c.itemsPerRow?n.init():void 0}}(this)),angular.element(t).on("scroll",n.onScroll),d=[],d.push(e.$on("imagovirtuallist:init",function(){return n.init()})),n.$on("$destroy",function(){var i,e,l,o;for(angular.element(t).off("scroll",n.onScroll),l=[],i=0,e=d.length;e>i;i++)o=d[i],l.push(o());return l})}}}return t}(),angular.module("imago").directive("imagoVirtualList",["$window","$document","$rootScope","$timeout",ImagoVirtualList]),angular.module("imago").run(["$templateCache",function(t){t.put("/imago/imago-virtual-list.html",'<div ng-style="canvasStyle" class="canvas"></div>')}]);