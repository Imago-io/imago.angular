(function(){var i;i=function(){return function(i,t,e,l){return{restrict:"E",scope:!0,templateUrl:"/imago/imago-virtual-list.html",transclude:!0,controller:function(){},controllerAs:"imagovirtuallist",bindToController:{data:"=",onBottom:"&",scroll:"=",offsetBottom:"@",uuid:"@"},link:function(r,o,n,a,s){var u,c,d;return s(r,function(i){return o.children().append(i)}),c={},c.scrollTop=0,c.browserKey=("undefined"!=typeof bowser&&null!==bowser?bowser.safari:void 0)<=8?"-webkit-transform":"transform",c.uuid=r.imagovirtuallist.uuid||"id",r.imagovirtuallist.offsetBottom||(r.imagovirtuallist.offsetBottom=i.innerHeight),u=document.createElement("div"),u.id="master-item",u.className=n.classItem,u.style.opacity=0,u.style.zIndex=-1,o.append(u),r.init=function(){if(!c.initRunning)return c.initRunning=!0,r.visibleProvider=[],l(function(){var t;return c.divWidth=u.clientWidth,c.divHeight=u.clientHeight,c.itemsPerRow=Math.floor(o[0].clientWidth/c.divWidth),t=Math.round(i.innerHeight/c.divHeight),c.cellsPerPage=t*c.itemsPerRow,c.numberOfCells=3*c.cellsPerPage,c.itemsPerRow>1?c.canvasWidth=c.itemsPerRow*c.divWidth:c.canvasWidth=null,c.updateData(),c.initRunning=!1},200)},c.updateData=function(){if(r.imagovirtuallist.data)return c.canvasHeight=Math.ceil(r.imagovirtuallist.data.length/c.itemsPerRow)*c.divHeight,r.canvasStyle={height:c.canvasHeight+"px",width:c.canvasWidth+"px"},c.updateDisplayList()},c.updateDisplayList=function(){var t,e,l,o,n,a,s;for(o=Math.max(Math.round(c.scrollTop/c.divHeight)-Math.round(i.innerHeight/c.divHeight),0),t=Math.min(o+c.numberOfCells,c.numberOfCells),l=o*c.itemsPerRow,r.visibleProvider=r.imagovirtuallist.data.slice(l,l+t),e=_.chunk(r.visibleProvider,c.itemsPerRow),n=0,s=r.visibleProvider.length;n<s;)a=function(){var i,t,l,o,a,s,u;for(t=o=0,s=e.length;o<s;t=++o)for(l=a=0,u=(i=e[t]).length;a<u;l=++a)if(i[l][c.uuid]===r.visibleProvider[n][c.uuid])return{chunk:t,inside:l}}(),r.visibleProvider[n].styles={},r.visibleProvider[n].styles[c.browserKey]="translate("+c.divWidth*a.inside+"px, "+(o+a.chunk)*c.divHeight+"px)",n++;if(r.imagovirtuallist.scroll)return r.scroll()},r.scroll=function(){if(r.imagovirtuallist.scroll)return l(function(){return c.scrollTop=angular.copy(r.imagovirtuallist.scroll),r.imagovirtuallist.scroll=0,t.scrollTop(c.scrollTop,0)})},r.onScroll=function(){return c.scrollTop=i.scrollY||i.pageYOffset,c.canvasHeight-c.scrollTop<=Number(r.imagovirtuallist.offsetBottom)&&r.imagovirtuallist.onBottom(),c.updateDisplayList(),r.$digest()},r.init(),r.$watch("imagovirtuallist.data",function(i){return c.updateData()}),angular.element(i).on("resize",function(){if(Math.floor(o[0].clientWidth/u.clientWidth)!==c.itemsPerRow)return r.init()}),angular.element(i).on("scroll",r.onScroll),(d=[]).push(e.$on("imagovirtuallist:init",function(){return r.init()})),r.$on("$destroy",function(){var t,e,l,o;for(angular.element(i).off("scroll",r.onScroll),l=[],t=0,e=d.length;t<e;t++)o=d[t],l.push(o());return l})}}}}(),angular.module("imago").directive("imagoVirtualList",["$window","$document","$rootScope","$timeout",i])}).call(this),angular.module("imago").run(["$templateCache",function(i){i.put("/imago/imago-virtual-list.html",'<div ng-style="canvasStyle" class="imago-virtual-list-content"></div>')}]);