var imagoImage,imagoImageController;imagoImage=function(){function i(i,t){return{scope:!0,templateUrl:"/imago/imago-image.html",controller:"imagoImageController as imagoimage",require:"?^imagoSlider",bindToController:!0,link:function(i,e,s,a){var o;return o={destroy:function(){return i.$destroy(),e.remove()}},s.imagoImage.match(/[0-9a-fA-F]{24}/)?o.watch=s.$observe("imagoImage",function(e){return e?(o.watch(),e=t.find({_id:e}),e.serving_url?i.imagoimage.init(e):o.destroy()):void 0}):o.watch=i.$watch(s.imagoImage,function(t){return function(t){return t?(o.watch(),t.serving_url?i.imagoimage.init(t):o.destroy()):void 0}}(this))}}}return i}(),imagoImageController=function(){function i(i,t,e,s,a){var o,r;this.$rootScope=i,this.$attrs=t,this.$scope=e,this.$element=s,this.$timeout=a,this.imageStyle={},this.loaded=!1,this.dpr=Math.ceil(window.devicePixelRatio,1)||1,this.opts={align:"center center",sizemode:"fit",autosize:"none",responsive:!0,scale:1,lazy:!0,maxsize:4e3};for(o in this.$attrs)this.opts[o]&&("true"===(r=this.$attrs[o])||"false"===r?this.opts[o]=JSON.parse(this.$attrs[o]):isNaN(this.$attrs[o])?this.opts[o]=this.$attrs[o]:this.opts[o]=Number(this.$attrs[o]));this.$rootScope.$on("resize",function(i){return function(){return i.resize()}}(this))}return i.prototype.init=function(i){var t,e,s,a;return this.data=i,this.resolution=this.data.resolution.split("x"),this.assetRatio=_.first(this.resolution)/_.last(this.resolution),this.spacerStyle={paddingBottom:_.last(this.resolution)/_.first(this.resolution)*100+"%"},(null!=(t=this.data.fields)&&null!=(e=t.crop)?e.value:void 0)&&!this.$attrs.align&&(this.opts.align=this.data.fields.crop.value),(null!=(s=this.data.fields)&&null!=(a=s.sizemode)?a.value:void 0)&&"default"!==this.data.fields.sizemode.value&&!this.$attrs.sizemode&&(this.opts.sizemode=this.data.fields.sizemode.value),this.opts.lazy===!1?this.removeInView=!0:void 0},i.prototype.resize=function(){return this.width=this.$element[0].clientWidth,this.height=this.$element[0].clientHeight,this.height&&(this.wrapperRatio=this.width/this.height),console.log("resize",this.wrapperRatio,this.width,this.height,this.resolution)},i.prototype.compile=function(){var i;return this.resize(),"crop"===this.opts.sizemode&&this.height?i=this.assetRatio<=this.wrapperRatio?Math.round(Math.max(this.width,this.width/this.assetRatio)):Math.round(Math.max(this.height,this.height*this.assetRatio)):this.height&&"height"!==this.opts.autosize?this.width&&"width"!==this.opts.autosize?i=this.assetRatio<=this.wrapperRatio?Math.round(Math.max(this.height,this.height*this.assetRatio)):Math.round(Math.max(this.width,this.width/this.assetRatio)):(this.opts.autosize="width",i=Math.round(Math.max(this.height,this.height*this.assetRatio))):(this.opts.autosize="height",i=Math.round(Math.max(this.width,this.width/this.assetRatio))),i=parseInt(Math.min(i*this.dpr,this.opts.maxsize)),i===this.servingSize?void(this.loaded=!0):(this.servingSize=Math.max(i,320),this.opts.servingUrl=this.data.serving_url+"=s"+this.servingSize*this.opts.scale,this.render())},i.prototype.render=function(){var i;return this.opts.lazy&&!this.visible?self.visibleFunc=this.$scope.$watch("imagoimage.visible",function(i){return function(t){return t?(self.visibleFunc(),i.visible=!0,i.render()):void 0}}(this)):(i=angular.element("<img>"),i.on("load",function(i){return function(){return i.$scope.$applyAsync(function(){return i.imgUrl=i.opts.servingUrl,i.loaded=!0})}}(this)),i[0].src=this.opts.servingUrl)},i}(),angular.module("imago").directive("imagoImage",["$timeout","imagoModel",imagoImage]).controller("imagoImageController",["$rootScope","$attrs","$scope","$element","$timeout",imagoImageController]),angular.module("imago").run(["$templateCache",function(i){i.put("/imago/imago-image.html",'<div ng-class="[{\'loaded\': imagoimage.loaded}, imagoimage.opts.align, imagoimage.fit, imagoimage.opts.sizemode]" class="imagoimage"><div ng-style="::imagoimage.spacerStyle" class="spacer"></div><img ng-src="{{::imagoimage.data.serving_url}}=s3" ng-style="::imagoimage.imgSmallStyle" class="small"/><img ng-src="{{imagoimage.imgUrl}}" ng-show="imagoimage.imgUrl" visible="imagoimage.visible" in-view="imagoimage.visible = $inview &amp;&amp; imagoimage.compile()" in-view-remove="imagoimage.removeInView" class="large"/><pre>sizemode: {{imagoimage.opts.sizemode}}  align: {{imagoimage.opts.align}}<br/>class {{imagoimage.loaded}}</pre></div>')}]);