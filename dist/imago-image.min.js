(function(){var i,t,e=function(i,t){return function(){return i.apply(t,arguments)}};i=function(){function i(i){return{restrict:"E",scope:!0,templateUrl:"/imago/imago-image.html",controller:"imagoImageController as imagoimage",require:"?^imagoSlider",bindToController:!0,link:function(t,e,s,a){var o,r,n,h;for(r in s)_.isUndefined(t.imagoimage.opts[r])||("true"===(n=s[r])||"false"===n?t.imagoimage.opts[r]=JSON.parse(s[r]):isNaN(s[r])?t.imagoimage.opts[r]=s[r]:t.imagoimage.opts[r]=Number(s[r]));return o=function(){return t.$applyAsync(function(){return t.$destroy(),e.remove()})},s.data.match(/[0-9a-fA-F]{24}/)?h=s.$observe("data",function(e){return e?(h(),i.getById(e).then(function(i){return(null!=i?i.serving_url:void 0)?t.imagoimage.init(i):o()})):void 0}):s.data.match(/^\//)?i.getData(s.data).then(function(i){var e,s,a;for(e=0,a=i.length;a>e;e++){if(s=i[e],!(null!=s?s.serving_url:void 0))return o();t.imagoimage.init(s);break}}):h=t.$watch(s.data,function(i){return i?(h(),i.serving_url?t.imagoimage.init(i):o()):void 0}),t.setServingSize=function(i){return a?a.setServingSize(i):void 0}}}}return i}(),t=function(){function i(i,t,s,a,o,r){this.$rootScope=i,this.$attrs=t,this.$scope=s,this.$element=a,this.$timeout=o,this.$parse=r,this.render=e(this.render,this),this.loaded=!1,this.imageStyle={},this.watchers=[],this.opts={align:"center center",sizemode:"fit",autosize:"none",responsive:!0,scale:1,lazy:!0,maxsize:4e3,placeholder:!1,allowDrag:!0,width:void 0,height:void 0,path:""},this.$scope.$on("$destroy",function(i){return function(){var t,e,s,a,o;for(s=i.watchers,a=[],t=0,e=s.length;e>t;t++)o=s[t],a.push(o());return a}}(this))}return i.prototype.init=function(i){var t,e,s,a;return this.asset=i,this.placeholderUrl=this.asset.b64||this.asset.serving_url+"=s3",this.resolution=this.asset.resolution.split("x"),this.assetRatio=_.head(this.resolution)/_.last(this.resolution),this.spacerStyle={paddingBottom:_.last(this.resolution)/_.head(this.resolution)*100+"%"},(null!=(t=this.asset.fields)&&null!=(e=t.crop)?e.value:void 0)&&!this.$attrs.align&&(this.opts.align=this.asset.fields.crop.value),(null!=(s=this.asset.fields)&&null!=(a=s.sizemode)?a.value:void 0)&&"default"!==this.asset.fields.sizemode.value&&!this.$attrs.sizemode&&(this.opts.sizemode=this.asset.fields.sizemode.value),this.opts.lazy===!1&&(this.removeInView=!0),this.opts.responsive&&(this.watchers.push(this.$rootScope.$on("resize",function(i){return function(){return i.visible?i.$scope.$applyAsync(function(){return i.getSize(),i.resize()}):void 0}}(this))),this.watchers.push(this.$rootScope.$on("resizestop",function(i){return function(){return i.visible?i.$scope.$applyAsync(function(){return i.getSize(),i.resize(),i.getServingUrl()}):void 0}}(this)))),this.$scope.$applyAsync(function(i){return function(){var t;return i.$attrs.width||i.$attrs.height?(i.width=parseInt(i.$attrs.width||0),i.height=parseInt(i.$attrs.height||0)):i.getSize(),0===i.height&&0===i.width?console.log("need width or/and height for static or relative positioning"):(i.height>0&&0===i.width?i.mainSide="autoheight":i.width>0&&0===i.height?i.mainSide="autowidth":"crop"===i.opts.sizemode?i.mainSide=i.assetRatio>1?"height":"width":i.mainSide=i.assetRatio<1?"height":"width",i.opts.lazy&&!i.visible?t=i.$scope.$watch("imagoimage.visible",function(e){return e?(t(),i.resize(),i.getServingUrl()):void 0}):(i.getSize(),i.resize(),i.getServingUrl()))}}(this))},i.prototype.getSize=function(){return this.width=this.$element.children()[0].clientWidth,this.height=this.$element.children()[0].clientHeight},i.prototype.resize=function(){var i;return"autoheight"!==(i=this.mainSide)&&"autowidth"!==i?(this.wrapperRatio=this.width/this.height,"crop"===this.opts.sizemode?this.mainSide=this.assetRatio<this.wrapperRatio?"width":"height":this.mainSide=this.assetRatio>this.wrapperRatio?"width":"height"):void 0},i.prototype.getServingUrl=function(){var i;return this.visible=!0,i="autoheight"===this.mainSide?Math.round(Math.max(this.height,this.height*this.assetRatio)):"crop"===this.opts.sizemode&&this.height?this.assetRatio<=this.wrapperRatio?Math.round(Math.max(this.width,this.width/this.assetRatio)):Math.round(Math.max(this.height,this.height*this.assetRatio)):this.assetRatio<=this.wrapperRatio&&this.height?Math.round(Math.max(this.height,this.height*this.assetRatio)):Math.round(Math.max(this.width,this.width/this.assetRatio)),i=parseInt(Math.min(i*(Math.ceil(window.devicePixelRatio,1)||1),this.opts.maxsize)),i===this.servingSize?void(this.loaded=!0):(this.servingSize=Math.max(i,60),this.opts.servingUrl=this.asset.serving_url+"=s"+this.servingSize*this.opts.scale,this.$scope.setServingSize("=s"+i*this.opts.scale),this.render())},i.prototype.render=function(){var i;return i=angular.element("<img>"),i.on("load",function(i){return function(){return i.$scope.$applyAsync(function(){return i.imgUrl=i.opts.servingUrl,i.loaded=!0})}}(this)),i[0].src=this.opts.servingUrl},i}(),angular.module("imago").directive("imagoImage",["imagoModel",i]).controller("imagoImageController",["$rootScope","$attrs","$scope","$element","$timeout","$parse",t])}).call(this),angular.module("imago").run(["$templateCache",function(i){i.put("/imago/imago-image.html",'<div ng-class="[{\'loaded\': imagoimage.loaded}, imagoimage.opts.align, imagoimage.opts.sizemode, imagoimage.mainSide, {\'noplaceholder\': !imagoimage.opts.placeholder}]" in-view="imagoimage.visible = $inview" in-view-remove="imagoimage.removeInView" in-view-options="{debounce: 50}" class="imago-image-content"><div ng-style="::imagoimage.spacerStyle" class="spacer"></div><img ng-src="{{::imagoimage.placeholderUrl}}" class="small"/><img ng-src="{{imagoimage.imgUrl}}" class="large"/><div ng-if="!imagoimage.opts.allowDrag" class="prevent-drag"></div></div>')}]);